# VideoLingo 新工作流程变更说明

## 概述
本次更新实现了您要求的新工作流程：
1. **并行下载**：先下载360P视频快速开始字幕处理，同时后台下载最高画质
2. **字幕烧录**：新增直接将字幕烧录到最高画质视频的功能
3. **UI优化**：简化了操作流程，提升用户体验

## 主要变更

### 1. 并行下载流程
- **修改文件**：`core/_1_ytdlp.py`
  - 新增 `download_video_async()` 函数用于后台下载
  - 支持为不同分辨率视频添加后缀避免冲突

- **修改文件**：`core/st_utils/download_video_section.py`
  - 重写下载逻辑，先下载360P用于快速处理
  - 异步启动最高画质下载
  - 新增下载状态显示

### 2. 字幕烧录功能
- **新增文件**：`core/subtitle_burner.py`
  - `burn_subtitle_to_video()`：使用ffmpeg烧录字幕
  - `get_highest_quality_video()`：自动识别最高画质视频
  - 支持自定义输入视频和字幕文件

### 3. UI界面更新
- **修改文件**：`st.py`
  - 集成字幕烧录功能
  - 优化工作流程按钮
  - 修复校对工具使用最高画质视频

- **修改文件**：`subtitle_editor_streamlit.py`
  - 更新视频查找逻辑，使用最高画质视频预览

## 新工作流程

### 完整流程
1. **输入视频链接** → **点击"开始处理"**
2. **自动下载360P** → **立即开始字幕生成**
3. **后台下载最高画质** → **并行处理**
4. **字幕生成完成** → **点击"开始校对"**
5. **校对完成** → **返回主界面点击"烧录字幕"**
6. **获得带字幕的最高画质视频**

### 文件命名规则
- 360P视频：`[视频名]_360p.[扩展名]`
- 最高画质：`[视频名]_best.[扩展名]`
- 烧录字幕：`[视频名]_with_subtitles.mkv`

## 使用说明

### 启动应用
```bash
streamlit run st.py
```

### 测试新功能
```bash
python test_workflow.py
```

### 手动烧录字幕
如果需要手动烧录字幕，可以使用：
```python
from core.subtitle_burner import burn_subtitle_to_video
output_file = burn_subtitle_to_video()
```

## 注意事项
1. 确保ffmpeg已安装并在系统PATH中
2. 后台下载最高画质需要稳定的网络连接
3. 烧录字幕使用H.264编码，输出格式为MKV
4. 所有文件都保存在`output/`目录下

## 故障排除
- 如果后台下载失败，可以手动重新下载最高画质
- 如果找不到视频文件，检查output目录下的文件命名
- 字幕烧录失败时，请检查ffmpeg是否安装正确